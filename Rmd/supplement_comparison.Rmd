---
title: "Appendix 4: Comparison of land footprint estimates with previous study"
author: "Quentin D. Read"
date: "10/27/2021"
output: 
  pdf_document:
      fig_caption: yes
header-includes:
- \usepackage{caption}
- \captionsetup{labelformat=empty}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
final_output_path <- '~/biodiversity-farm2fork/data'
raw_data_path <- '/nfs/qread-data/raw_data'
```

## Summary

This document is a supplement to the manuscript "Biodiversity effects of food system sustainability actions from farm to fork" by Quentin D. Read, Kelly L. Hondula, and Mary K. Muth, currently under consideration for publication in *PNAS*. 

In this document, we compare the land footprint estimates generated by our own models with the estimates generated by Laroche et al. (2020). We describe how we harmonized our results with theirs and present a figure and table comparing the results. Overall, we found that our study estimated higher land footprints than Laroche and colleagues'. In both studies, the relative differences between diets are qualitatively very similar. However, Laroche et al. estimated the reduction in land footprint, especially foreign-sourced, due to diet shifts to be much greater than we did.

## Harmonization

Laroche et al. provide estimates of the per capita land footprint of the average American diet and of several other diets. They provide totals for domestic and imported (outsourced in their terminology) land footprint, and they further disaggregate the foreign land footprint into cropland and grassland. These estimates are given in Table 3 of their manuscript.

We assumed that their term grassland corresponds to our definition of pastureland, and that their term cropland corresponds to the total of our annual cropland and permanent cropland categories.

In the following code, we load the data and then sum up our estimates by origin and land type, renaming them to use the same terminology as Laroche et al. (`foreign` becomes `outsourced` and `pasture` becomes `grassland`, and `cropland` is the sum of `annual` and `permanent`). We also divide our estimate by the 2012 USA population to make it a per capita estimate matching Laroche et al., and convert our units from square kilometers to square meters. 

```{r sum our estimates}
library(data.table)
library(ggplot2)
library(dplyr)
library(purrr)
library(kableExtra)
library(scales)

load(file.path(final_output_path, 'all_app_data.RData'))

laroche_landuse <- fread(file.path(raw_data_path, 'biodiversity/laroche2020_table3.csv'))

# Sum up the land footprint by origin x land type
landflow_cols <- c('flow_inbound_total', 'flow_inbound_foreign')
our_landuse <- county_land_flow_sums[, lapply(.SD, sum), 
                                     by = .(scenario_diet, scenario_waste, land_type), 
                                     .SDcols = landflow_cols]
setnames(our_landuse, old = landflow_cols, new = c('total', 'outsourced'))

# 2012 USA population from https://www.multpl.com/united-states-population/table/by-year
pop2012 <- 314e6
our_landuse_long <- 
  melt(our_landuse, variable.name = 'origin', value.name = 'total_footprint')
our_landuse_long[, per_capita_footprint := total_footprint / pop2012 * 1e6 ]

# Sum up annual and permanent cropland. Rename pasture to grassland
our_landuse_long[, land_type := ifelse(land_type %in% c('annual','permanent'), 
                                       'cropland', 'grassland')]
our_landuse_sums <- our_landuse_long[scenario_waste == 'baseline', 
                                     .(per_capita_footprint = sum(per_capita_footprint)), 
                                     by = .(scenario_diet, land_type, origin)]

# Add additional grand totals
total_outsourced <- our_landuse_sums[, 
                                     .(per_capita_footprint = sum(per_capita_footprint)), 
                                     by = .(scenario_diet, origin)]
total_outsourced[, land_type := 'total']
our_landuse_sums <- rbindlist(list(our_landuse_sums, total_outsourced), use.names = TRUE)
our_landuse_sums[, source := 'this study']
setnames(our_landuse_sums, old = 'scenario_diet', new = 'diet')
```

Next, we harmonize the Laroche et al. estimates with ours. First, we sum cropland used for food and cropland used for feed, which aren't differentiated in our final estimates.

```{r sum Laroche estimates}
laroche_landuse[, origin := ifelse(`Land type` == 'total', 'total', 'outsourced')]
laroche_landuse[, land_type := map_chr(strsplit(`Land type`, ' '), 1)]
setnames(laroche_landuse,
         old = c('Diet','Per capita footprint'), 
         new = c('diet', 'per_capita_footprint'))
laroche_landuse_sums <- 
  laroche_landuse[, 
                  .(per_capita_footprint = sum(per_capita_footprint)), 
                  by = .(diet, land_type, origin)]
laroche_landuse_sums[, source := 'Laroche et al.']

comparison_dat <- rbind(our_landuse_sums, laroche_landuse_sums)
```

Next, we matched the names of diets across the two studies. Laroche et al. investigated some diets that we didn't consider, and used different names. We matched their `AAD` (Average American diet) with our `baseline` diet, and their `EAT` diet with our `planetaryhealth` diet. Those should be identical. Their `lacto-ovo vegetarian` diet should correspond closely with our `vegetarian` (USDA healthy vegetarian) diet, so we matched those up for comparison purposes.

```{r match diet names}
comparison_dat[diet == 'AAD', diet := 'baseline']
comparison_dat[diet == 'lacto-ovo vegetarian', diet := 'vegetarian']
comparison_dat[diet == 'EAT', diet := 'planetaryhealth']
```

## Results

The figure below shows that while our estimates are uniformly higher, the relative differences between diets are the same between studies. Importantly, the total land footprint decreases relative to baseline for the vegetarian and Planetary Health diets, as do the outsourced total and outsourced grassland footprints. However, the outsourced cropland footprints increase relative to baseline, with the vegetarian diet increasing more than the Planetary Health diet. Note that the individual panels have different y-axis limits.

```{r figure, fig.cap = 'Figure S34. Comparison between our land footprint estimates and those of Laroche and colleagues'}
ggplot(comparison_dat[diet %in% c('baseline','vegetarian','planetaryhealth') & 
                        (origin == 'outsourced' | land_type == 'total')], 
       aes(x = diet, y = per_capita_footprint, group = source, fill = source)) +
  geom_col(position = 'dodge') +
  facet_wrap(land_type ~ origin, scales = 'free_y') +
  scale_y_continuous(expand = expansion(mult = c(0, 0.02)), 
                     name = 'Per capita land footprint (m2/cap/y)') +
  theme_bw() +
  theme(legend.position = 'bottom',
        strip.background = element_blank(),
        panel.grid = element_blank()) +
  scale_fill_manual(values = c(viridis::viridis(7, alpha = 0.7)[c(3,6)]))
```

The *relative* column in the table below indicates the percent difference between the land footprint estimate of Laroche et al. and the corresponding estimate from the present study (differences between pairs of bars in the figure). For example a value of 129% indicates that our estimate is 129% higher, or 2.29 times as high, as the estimate from Laroche et al. All are positive indicating that our estimates are uniformly higher. 

```{r table}
comparison_wide <- 
  dcast(comparison_dat[diet %in% c('baseline','vegetarian','planetaryhealth')], 
        diet + land_type + origin ~ source, value.var = 'per_capita_footprint')
comparison_wide[, relative := round((`this study`/`Laroche et al.` - 1), 2)]
```

```{r kable, echo = FALSE}
kable_dat <- comparison_wide[, .(diet, land_type, origin, relative)]
kable_dat[, relative := percent(relative, accuracy = 1)]

options(knitr.kable.NA = '\u2014')

kbl(kable_dat,
    col.names = c('Diet', 'Land use type', 'Origin', 'Relative difference'),
    caption = 'Table S10. Relative differences between our estimates and those of Laroche and colleagues.',
    booktabs = TRUE) %>%
  kable_styling(latex_options = c('scale_down', 'striped', 'HOLD_position'))
```