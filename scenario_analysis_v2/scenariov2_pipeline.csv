Section,Order to run,Script name,Description,Input files,Input description,Output files,Output description,Note
main domestic analysis,1,county_downscale_nass_cbp.R,"Assemble county-level data from NASS and CBP datasets so that other state-level variables can be downscaled to county, proportional to the county-level data we do have.",raw_data/USDA/2012_cdqt_data.txt; raw_data/Census/CBP/cbp12co.txt; oilseed_grain_proportions.csv; BEA_NAICS07_NAICS12_crosswalk.csv,"Raw NASS2012 data, raw CBP2012 data, data for disaggregation of oilseed and grain NAICS category, NAICS-BEA crosswalk",county_weightings_for_downscale.csv,"By county and BEA, numbers of establishments and employees",Was rerun correcting for Bedford City
main domestic analysis,2,tabulate_cropland_nass_by_bea.R,"Total up the land area from the NASS dataset for each state x NAICS code, and then map NAICS to BEA",see above,Same input as #1 (sources script 1),nass_workers_receipts_3landtypes_bea.csv,"by state and BEA, commodity receipts, number of employees, and land area of annual crop, permanent crop, and pasture",
main domestic analysis,3,downscale_state_production_county.R,"Use the county-level weightings to downscale state-level production of goods to the county level, based on numbers of establishments in each county",receipts_bea_sctg_x_state.csv; county_weightings_for_downscale.csv,Production by BEA code by state (created in sctg_to_bea.R); number of establishments and employees by BEA code by county,county_production2012.csv,Downscaled production vector by BEA code by county,
main domestic analysis,4,land_exchange_by_state.R,"Divide the land areas by the total commodity receipts for each BEA code for each state to get a ""land exchange"" or I-O model coefficient matrix for each state.",nass_workers_receipts_3landtypes_bea.csv,"by state and BEA, commodity receipts, number of employees, and land area of annual crop, permanent crop, and pasture",state_land_exchange_tables.RData,"list of land exchange matrices, one for each state. Each matrix is 3x10 where rows represent the 3 land types and columns the 10 BEA codes for primary agricultural goods",
main domestic analysis,5,read_diet_data.R,Munging of the USA dietary guidelines values,dietaryguidelinesfoodpatterns_cleaned.xlsx,manually cleaned USA dietary guidelines 2015 data,us_dietary_guidelines_wide.csv; us_dietary_guidelines_long.csv,processed USA dietary guidelines 2015,
main domestic analysis,6,healthy_diet_simulation.R,"Further process the diet data, converting everything to calories so they are in common units, then joining it with LAFA based on a crosswalk table",raw_data/food_consumption/diet_guidelines/lancet_planetary_health_diet.csv and us_dietary_guidelines_long.csv; lafa_dietary_guidelines_crosswalk.csv; the output of clean_lafa2019.R,Lancet and USA dietary guidelines diet data; crosswalk to harmonize LAFA with the diets; cleaned LAFA data,proportion_diet_lancet.csv; proportion_diet_usaguidelines.csv; lafa_joined_with_diet_proportions.csv,Lancet and USA dietary guidelines data all converted to the same units; LAFA joined with the diet data,
main domestic analysis,7,waste_reduction_simulation.R,Use the preconsumer and consumer waste estimates from LAFA to add waste reduction factors to the diet factors in the joined LAFA-diet data,lafa_joined_with_diet_proportions.csv,LAFA joined with the diet data,lafa_with_production_factors_diet_x_waste.csv,"Factors, relative to baseline, representing the change in food consumption for each LAFA category under alternative diet scenarios and waste reduction scenarios",Was rerun correcting for production factor mistake
main domestic analysis,8,harmonize_scenarios_bea.R,"Map the LAFA categories to BEA categories, then calculate the consumption factors for diet scenarios, waste reduction scenarios, and factorial combination of the two, for each BEA category. This requires supplementing the LAFA data and diet data with assumptions for change in beverage consumption which isn't included in either LAFA or explicitly in the diet data.",lafa_with_production_factors_diet_x_waste.csv; qfahpd2.csv; qfahpd_lafa_crosswalk.csv; lafa_qfahpd_naics.csv; lafa_category_structure.csv; bea_lafa_crosswalk.csv,"The factors in LAFA units, the QFAHPD data, then a whole bunch of crosswalks: BEA-QFAHPD, QFAHPD-LAFA, LAFA-BEA, BEA-LAFA, and an internal LAFA harmonization table to show which LAFA categories are aggregations of other ones",bea_consumption_factors_diet_waste_scenarios.csv,"Food consumption factors relative to baseline for all food-related BEA codes in all diet scenarios, waste scenarios, and diet x waste scenarios",Was rerun correcting for production factor mistake
main domestic analysis,9,county_level_consumption.R,"First use the county-level personal income data to downscale the BEA baseline personal consumption expenditures vector to each county. Then, use the consumption factors to create an alternative vector for each county in each scenario. Next, apply the I-O approach by multiplying the Leontief inverse by the vector for each county to get the total demand from each county in each scenario, including intermediate.",data/raw_data/commodity_flows/Lin_supp_info/County Personal Income.xlsx; data/raw_data/BEA/formatted/use2012.csv; USEEIO2012_DRC.csv; bea_consumption_factors_diet_waste_scenarios.csv,Total personal income for each USA county in 2012; use table from the 2012 BEA data; direct requirements coefficient matrix from the built USEEIO model; food consumption factors by BEA code for all scenarios,county_consumption2012_allscenarios.csv; county_totaldemand2012_allscenarios.csv,"downscaled personal consumption expenditure vector for each county in each scenario; total demand vector (intermediate + final) for each county in each scenario. Includes all goods, not just agricultural.",Was rerun correcting for Bedford City and production factor mistake
main domestic analysis,10,county_allocate_flows_simple.R,"Use the assumption that production of each county is proportionally allocated to all counties, ignoring the distance between them. For all counties, BEA categories, and scenarios, allocate all county production to a consuming county.",county_totaldemand2012_allscenarios.csv; county_production2012.csv; naics_crosswalk_final.csv,downscaled total demand vector for each county in each scenario; downscaled production vector for each county (relative differences in production do not change by scenario); lookup table for agricultural BEA codes,county_consumption_csvs/D_{dietscenario}_WR_{wastescenario}_wide.csv,inter-county flows of agricultural goods for each BEA category in each scenario,Was rerun correcting for production factor mistake
main domestic analysis,11,land_footprint_estimate.R; newer version land_footprint_estimate_DT.R,"Apply the second part of the EEIO model by multiplying the county total demand for each county in each scenario) allocated across all producing counties, times the land exchanges for the states where the producing counties are located, to result in land flows between each county in each scenario (including 3 land types).",state_land_exchange_tables.RData; county_consumption_csvs from previous script,land exchange matrices for each state; inter-county flows of agricultural goods in each scenario,county_land_consumption_csvs/D_{dietscenario}_WR_{wastescenario}_landconsumption.csv,"inter-county flows of land, in 3 categories, in each scenario",Was rerun correcting for production factor mistake
main domestic analysis,12,county_to_tnc_landflows.R; new version county_to_tnc_landflows_DT.R (see also the version county_landflows_weight_tnc_DT.R in DT_version/deprecated/ folder),"Convert flows from inter-county flows to inter-TNC ecoregion flows (first incoming only, or TNC to county, and next incoming+outgoing, or TNC to TNC). The first part is done by proportionally dividing up the flows exiting each county to flows exiting each TNC ecoregion that makes up that county, based on the proportions of NLCD pixels in each ecoregion in each county. The second part is done by proportionally dividing up the flows entering each county to flows entering each TNC ecoregion that makes up that county, based on the proportion of population in each ecoregion in each county. (Those proportional counts were done in previous scripts described elsewhere.)",NLCDcrop_county_x_TNC.csv; population_county_x_TNC_longform.csv; county_land_consumption_csvs from the previous script,Pixel counts of NLCD crop and pasture pixels in all intersection polygons of county and TNC ecoregion; population counts for the same; inter-county flows of land in each scenario,ecoregion_landflow_csvs/D_{dietscenario}_WR_{wastescenario}_landflows_tnc_to_county.csv and landflows_tnc_to_tnc.csv; landflows_tnc_x_tnc_all_scenarios.csv,"flows of land from each TNC ecoregion to each county in each scenario; inter-ecoregion flows of land in each scenario (separate files for each scenario, and combined into one)",Was rerun correcting for production factor mistake
main domestic analysis,13,landflows_to_biodiv.R; newer version landflows_to_biodiv_by_county_DT.R,"Multiply inter-TNC-ecoregion flows by biodiversity threat characterization factors to get the estimated species lost as a result of each flow. This is done by joining the TNC-TNC flow data for each scenario with the Chaudhary characterization factors for the TNC region where the flow originates, using the ""medium intensity"" assumption, then multiplying the flow in square meters by the CF in species lost per square meter of land occupied.",landflows_tnc_x_tnc_all_scenarios.csv; chaud2018si_CFs.csv,inter-ecoregion flows of land in each scenario; biodiversity threat characterization factors for each ecoregion,species_lost_all_scenarios.csv; species_lost_all_scenarios_occ.csv; species_lost_all_scenarios_occ_{intensity}.csv,all estimated biodiversity loss values associated with each flow of land in each scenario; also various subsets to save time loading later,Was rerun correcting for production factor mistake
foreign analysis,1,fao_foreign_land_imports_DT.R,Find how much cropland and pastureland is imported from foreign countries to United States under baseline and alternative scenario,contents of data/cfs_io_analysis/faostat2017; crossreference_tables/faostat_all_codes_harmonized.csv; bea_consumption_factors_diet_waste_scenarios.csv,"Extracted raw FAOSTAT data and the consumption factors for the different scenarios calculated in domestic script 7 above, crosswalk table for FAO categories and BEA codes",fao_production_trade_crops.csv; fao_production_trade_animals.csv; fao_VLT_provisonal.csv,production of crops and animal products in foreign countries and quantities of each sent to USA; exports to USA converted to virtual land transfers,
foreign analysis,2,fao_transfers_by_ecoregion_DT.R,Proportionally allocate the virtual land flows from exporting countries to ecoregions within those countries,raw_data/landuse/output_csvs/global_count_cropdominance.csv and global_count_pasture.csv; fao_VLT_provisional.csv,Pixel counts of crop and pasture pixels for all intersected country by TNC polygons (calculated in a spatial processing script); virtual land transfers originating from foreign countries,foreign_VLT_by_country_x_TNC.csv; foreign_VLT_by_TNC.csv,foreign virtual land transfers originating from each combination of country x TNC ecoregion; the same summed by ecoregion,
foreign analysis,3,foreign_vlt_to_counties_DT.R,"Allocate imported virtual land flows to importing counties, assuming for simplification that they are distributed proportionally based on county income",foreign_VLT_by_TNC.csv; raw_data/commodity_flows/Lin_supp_info/County Personal Income.xlsx,Virtual land flows summed by exporting ecoregion; county personal income totals for 2012,foreign_VLT_by_TNC_x_county.csv; foreign_VLT_to_counties.csv,foreign virtual land transfers by exporting ecoregion by importing county; the same summed for each importing county,
foreign analysis,4,foreign_landflows_to_biodiv_DT.R,Use Chaudhary's characterization factors to convert the virtual land flows to biodiversity flows by exporting ecoregion and importing county,raw_data/biodiversity/chaudhary2015SI/chaudh2018si_CFs.csv; foreign_VLT_by_country_x_TNC.csv; foreign_VLT_by_TNC_x_county.csv,"Characterization factors for biodiversity loss per land use from Chaudhary 2018; foreign virtual land transfers summed by exporting country x TNC, and by exporting TNC x importing county",scenarios/foreign_species_lost_by_export_country_x_tnc.csv; scenarios/foreign_species_lost_by_import_county.csv,foreign virtual biodiversity transfers summed by exporting region and by importing region (did not bother to save the full pairwise set of transfers due to space constraints),
visualizations,14,figs/figs_v2_summarydata.R,Calculate high level sums of flows for plotting; smaller ones that can be run locally,,,,,Was rerun correcting for production factor mistake
visualizations,15,figs/figs_v2_summarydata_parallel.R,"Calculate high level sums of flows for plotting; larger ones that require parallel procesisng, including flows of land and goods for all counties across all scenarios",,,,,
visualizations,16,figs/figs_v2_loaddata.R (sources figs_v2_lookups.R),"Loads all necessary data, map objects, lookup tables, and plotting themes for making figures",,,,,
visualizations,17,"All other scripts prefixed figs/figs_v2_X.R; includes consumption, countylandmaps, ecoregionmaps, foreign, panelmaps, statectyextmaps",,,,,,
